<?php// no direct access	defined('SITE_KEY') or die('File not found - <a href="/">please click here to return to the home page</a>');	if (isset($_GET['cat_id']) AND $_GET['cat_id'] != NULL)	{ $cat_id = $_GET['cat_id'];}	else { $cat_id = NULL;}		$this_page = $_SERVER['PHP_SELF'] . '?e='.$mod_id . '&tab='.$_GET['tab'];	$return_url = $this_page  . '&cat_id=' . $cat_id;		//---------Update error msg:	include_once ('cms_includes/cms_msg_update.php');	echo "\n\n";		//	Select a Category	echo TAB_2.'<fieldset class="AdminForm2">' ."\n";				$mysql_err_msg = 'Category information unavailable';		$sql_statement = 'SELECT mod_photo_gal_cats.gal_cat_id, cat_name'									.' FROM mod_photo_gal_cats, mod_photo_gal_mod_cat_asign'																		.' WHERE mod_photo_gal_mod_cat_asign.mod_id = '.$mod_id									.' AND mod_photo_gal_mod_cat_asign.gal_cat_id = mod_photo_gal_cats.gal_cat_id'																		.' ORDER BY seq'									;						$result = ReadDB ($sql_statement, $mysql_err_msg);					$num_cats = mysql_num_rows($result);			if ($num_cats < 1)		{			echo TAB_3.'<span class="WarningMSG" >( There are no Categories created ) : </span> ';		}				else					{			echo TAB_3.'Choose a Category for editing: <select onchange="location.href=this.value;">' ."\n";						if (!isset($_GET['cat_id']))			{									echo TAB_4.'<option value="" selected="selected" ></option>'."\n";								}			while ($cat_details = mysql_fetch_array ($result))			{				if ( $cat_details['gal_cat_id'] == $cat_id) 				{ 					$selected = ' selected="selected"';					$cat_name = $cat_details['cat_name'];				}				else 				{ 					$selected = '';					}				echo TAB_4.'<option value="'.$this_page.'&cat_id='.$cat_details['gal_cat_id'].'"'.$selected.' >'							.$cat_details['cat_name'].'</option>'."\n";				}									echo TAB_3.'</select>' ."\n";							}		echo TAB_2.'</fieldset>' ."\n";					if ($cat_id != NULL)	{		$update_url = '/CMS/cms_update/cms_update_photo_gal_Images.php';		echo TAB_2.'<form action="'.$update_url.'" name="update" method="post" enctype="multipart/form-data" >'."\n";			echo TAB_3.'<fieldset id="UpdateAll" class="AdminForm">'."\n";					echo TAB_4.'<legend class="Centered" >'."\n";										//-------------UPDATE BUTTON------------------------------------					echo TAB_5.'<input type="submit" name="update_all_imgs" value="Update Images" />'."\n";							echo TAB_4.'</legend>'."\n";				//	RESET button ======================================================								echo TAB_4.'<a href="'.$this_page.'&cat_id='.$cat_id.'"'."\n";					echo TAB_5.' title="Reload this page to Reset all Category data" >' ."\n";					echo TAB_5.'<img src="/images_misc/icon_refresh_24x24.png" alt="Reset" style="padding-right:10px; float:right;"/>' ."\n";				echo TAB_4.'</a>'. "\n";					echo TAB_4.'<script type="text/javascript" language="javascript">									$(document).ready(function()				{										//	Select all Check Boxes					$("#delete_check_all_master:checkbox").change(function() {						$(".delete_check_all").attr("checked", $(this).is(":checked"));						});										$("#delete_check_all_master:checkbox").click(function() {						if($("#delete_check_all_master:checkbox").is(":checked"))						{							alert("You have selected Delete ALL:"								+ "\n - Clicking the Update Button will Delete ALL Images for this Category ('.$cat_name.')");						}										});										//	MultiFile Uploader - requires: jquery.MultiFile.pack.js					$("#upload_photo_gal_images").MultiFile({ 						 STRING: {remove: \'<img src="/images_misc/icon_close_16x16.png" />\'}						,accept: \'gif|jpg|jpeg|png\'						,list: "#upload_images_list" 					}); 															$("#UploadPhotoGalImages").css("display" , "none");					$("#upload_photo_gal_images").change( function(){													$("#UploadPhotoGalImages").css("display" , "inline");												});				});									</script>'."\n";								//	Upload image file 						echo TAB_4.'<fieldset class="AdminForm3" style="clear: both;">'."\n";					echo TAB_5.'<input type="hidden" name="MAX_FILE_SIZE" value="'.MAX_FILE_SIZE_CMS.'" />' . "\n";					echo TAB_5.'<img src="/images_misc/icon_add_24x24.png" alt="Add" />'."\n";					echo TAB_5.'Select Image files to upload for this Category: '.$cat_name . "\n";					echo TAB_5.'<input type="file" id="upload_photo_gal_images" name="upload_photo_gal_images[]"' . "\n"; 						echo TAB_6.' style="font-size: 12px;" size="70" title="Use this to locate and upload image files for this Category ('						.$cat_name.')" /> '."\n";					echo TAB_5.'<p class="Small" >You can select multiple images to upload by clicking the Browse button again</p>'."\n";					echo TAB_5.'<div id="upload_images_list" style="border: solid 1px #cccccc; padding:5px; margin:5px;" ></div>'."\n";					echo TAB_5.'<input type="submit" id="UploadPhotoGalImages" name="submit_upload_gal_images" value="Upload selected Images" />'. "\n";										echo TAB_4.'</fieldset>'."\n";																		//	get all profile images		$mysql_err_msg = 'image information unavailable';			$sql_statement = 'SELECT'							.'  photo_id'							.', file_name'														.', photo_text'							.', active'														.' FROM mod_photo_gal_pics'							.' WHERE cat_id = "'.$cat_id.'"'																			.' ORDER BY seq, photo_id'							;									$image_info_result = ReadDB ($sql_statement, $mysql_err_msg);				//	no images set		if (mysql_num_rows($image_info_result) < 1)		{			echo TAB_4.'<fieldset class="AdminForm3" style="clear: both;">'."\n";				echo TAB_5.'<h3>No Images Assigned</h3>'."\n";			echo TAB_4.'</fieldset>'."\n";		}				else		{										echo TAB_4.'<fieldset class="AdminForm3" style="clear: both;">'."\n";			//	only one image (can not drag)			if (mysql_num_rows($image_info_result) == 1)			{				echo TAB_5.'<div>'."\n";			}					else			{				//	Select all to DELETE				echo TAB_5.'<fieldset class="AdminForm3" style="float: right;" title="tick this to select all images for deletion" >'."\n";					echo TAB_6.'<input id="delete_check_all_master" name="delete_all" type="checkbox" />'."\n";					echo TAB_6.'<span class="WarningMSG" >Delete ALL</span>'."\n";				echo TAB_5.'</fieldset>'."\n";												echo TAB_5.'<h3>Images set for this Category:</h3>'."\n";				echo TAB_5.'<p class="Small" >( You can drag the following images to change their order )</p>'."\n";								echo TAB_5.'<div class="sortableItems" style="padding: 0 5px 0 5px">'."\n";								}							$count = 1;			$image_pos_array = '';			while ($image_info = mysql_fetch_array ($image_info_result))			{				echo TAB_6.'<div id="'.$image_info['photo_id'].'" class="ImageThumbHolder" >'."\n";					//	Active					echo TAB_7.'<span style="cursor:default; margin-right:15px;">'."\n";																	if ($image_info['active'] == 'on')						{							$checked = ' checked="checked"';						}						else 						{ 							$checked = '';						}																											echo TAB_8.'<input type="checkbox" name="active[]" class="CheckAllActive"  value="'.$image_info['photo_id'].'" '."\n";							echo TAB_9.'title="Tick this box to Delete this Category"'.$checked.'/> Active'."\n";														echo TAB_7.'</span>'."\n";										//	Delete					echo TAB_7.'<p style="float:right;">' ."\n";															echo TAB_8.'<a href="#" class="ConfirmDeleteButton" title="Delete this Image" >' ."\n";							echo TAB_9.'<img src="/images_misc/icon_delete_24x24.png" alt="Delete"/>' ."\n";						echo TAB_8.'</a>'. "\n";					echo TAB_7.'</p>' ."\n";												echo TAB_7.'<p class="WarningMSG HideAtStart" style="border: solid 1px #cccccc; padding:5px;">' ."\n";												//	Cancel link						echo TAB_8.'<a href="#" class="CloseThisPanel" title="Do NOT Delete">' ."\n";							echo TAB_9.'<img src="/images_misc/icon_close_16x16.png" alt="Close" style="float:right;"/>' ."\n";						echo TAB_8.'</a>' ."\n";																			//	OK DELETE Image 						echo TAB_8.'Confirm:<input type="submit" name="delete_image_'.$image_info['photo_id'].'" style="color:#cc0000;"'."\n";								echo TAB_9.' value="DELETE" title="Delete this Image" />'."\n";												echo TAB_7.'</p>' ."\n";															//	Image Display				$img_url = '/_images_gallery/'.$image_info['file_name'];				if (file_exists('../'.$img_url ))				{															// get width to height ratio and restrict width if image to 'short and wide'						$image_details = getimagesize('../'.$img_url);										if ($image_details[0] / $image_details[1] > 1.5) 					{$dims = 'width="120px"';}										else {$dims = 'height="80px"';}		// otherwize restrict by height by default					echo TAB_7.'<a href="'.$img_url .'" rel="ColorBoxImage" >' ."\n";						echo TAB_8.'<img src="'.$img_url.'" '.$dims.' alt="'.$image_info['photo_text'].'" />' ."\n";					echo TAB_7.'</a>' ."\n";				}				else				{					echo TAB_7.'( Image File Not Found )' ."\n";				}									//	Image Caption:					echo TAB_7.'<fieldset class="AdminForm3" style="clear: both;">'."\n";						echo TAB_8.'<span><a href="#" class="OpenCloseNextDiv">[Image text]</a></span>'."\n";												echo TAB_8.'<textarea class="ProfileImageCaption_TextArea HideAtStart" id="ProfileImageCaption_'							.$image_info['photo_id'].'"'."\n";							echo TAB_9.'name="photo_text_'.$image_info['photo_id'].'">'. "\n";							echo $image_info['photo_text'] ."\n";							echo TAB_8.'</textarea>'."\n";																echo TAB_7.'</fieldset>'."\n";										//	check to Delete					echo TAB_7.'<fieldset style="clear: both;" >'."\n";						echo TAB_8.'<input type="checkbox" class="delete_check_all" name="delete_image_'.$image_info['photo_id'].'" '								.' style="cursor:default;" /> Delete' ."\n";										echo TAB_7.'</fieldset>' ."\n";													//	End Single Image container						echo TAB_6.'</div>'."\n";				if ($count == 1) {$image_pos_array .= $image_info['photo_id'];}				else {$image_pos_array .= ','.$image_info['photo_id'];}								$count++;			}									echo TAB_5.'</div>'."\n";									//	this is used to update image order				echo TAB_5.'<input type="hidden" id="ItemPosArray" name="image_pos_array" value="' . $image_pos_array . '" />'."\n";										echo TAB_4.'</fieldset>'."\n";					}																//	===========================	EDITED TO HERE	=======================================================================							echo TAB_3.'</fieldset>'."\n";				echo TAB_3.'<input type="hidden" name="cat_id" value="'.$cat_id.'" />'."\n";		echo TAB_3.'<input type="hidden" name="mod_id" value="'.$mod_id.'" />'."\n";		//	needed to get image resize settings		echo TAB_3.'<input type="hidden" name="return_url" value="'.$return_url.'" />'."\n";						echo TAB_2.'</form>' ."\n";					}		echo "\n\n";?>