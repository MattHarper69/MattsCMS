<?php//--------Set key to start include files	define( 'SITE_KEY', 1 );	if (isset($_GET['p']))	{		$page_id = $_GET['p'];	}	if (isset($_GET['m']))	{		$mod_id = $_GET['m'];	}	else{$mod_id = '';}	//	Avoids warnings	$file_path_offset = '../../';//----Get Common code to all pages	require_once ($file_path_offset.'includes/common.php');	require_once ($file_path_offset.'includes/access.php');		//	need name of table for lock/un-locking text and headings	$mysql_err_msg = 'Fetching Mod-Type-Info for Updating';	$sql_statement = 'SELECT mod_db_table from modules, _module_types' 									.' WHERE mod_id = '.$mod_id								.' AND modules.mod_type_id = _module_types.mod_type_id'								;		// DO Misc mod updates:		$mysql_err_msg = 'Up-dating Content';		$do_not_return = 0;			switch ($_REQUEST['a'])	{			//	activate		case 'activate':					$sql_statement = 'UPDATE modules SET'													.' active = "on"'									.' WHERE mod_id = "'.$mod_id.'"'										;																if (UpdateDB ($sql_statement, $mysql_err_msg))			{$_SESSION['update_success_msg'] = "Module Activated";}			else{$_SESSION['update_error_msg'] .= '- Internal Error - Was not able to ACTIVATE Module';}					//	===================================================================================				//	------------------			Need do Syncing				---------------------------				//	===================================================================================				break;				//	de-activate		case 'deactivate':					$sql_statement = 'UPDATE modules SET'													.' active = ""'									.' WHERE mod_id = "'.$mod_id.'"'										;																if (UpdateDB ($sql_statement, $mysql_err_msg))			{$_SESSION['update_success_msg'] = "Module De-Activated";}			else{$_SESSION['update_error_msg'] .= '- Internal Error - Was not able to DE-ACTIVATE Module';}				//	===================================================================================				//	------------------			Need do Syncing				---------------------------				//	===================================================================================						break;				//	lock mod		case 'lock':				$result = mysql_fetch_array (ReadDB ($sql_statement, $mysql_err_msg));			$mod_db_table = $result[0];					$sql_statement = 'UPDATE '.$mod_db_table.' SET'												.' locked = "on"'									.' WHERE mod_id = "'.$mod_id.'"'									;																if (UpdateDB ($sql_statement, $mysql_err_msg))			{$_SESSION['update_success_msg'] = "Module Locked";}			else{$_SESSION['update_error_msg'] .= ' - Internal Error - Was not able to LOCK Module';}				//	===================================================================================				//	------------------			Need do Syncing				---------------------------				//	===================================================================================									break;					//	un-lock mod		case 'unlock':			$result = mysql_fetch_array (ReadDB ($sql_statement, $mysql_err_msg));			$mod_db_table = $result[0];						$sql_statement = 'UPDATE '.$mod_db_table.' SET'												.' locked = ""'									.' WHERE mod_id = "'.$mod_id.'"'									;															if (UpdateDB ($sql_statement, $mysql_err_msg))			{$_SESSION['update_success_msg'] = "Module Un-Locked";}			else{$_SESSION['update_error_msg'] .= '- Internal Error - Was not able to UN-LOCK Module';}				//	===================================================================================				//	------------------			Need do Syncing				---------------------------				//	===================================================================================						break;				//	MOve mod update ??						//	Update Mod Pos - Ajax request		case 'update_mod_pos':					for ($i = 1; $i<6; $i++)			{				if (isset($_REQUEST['Mod_'.$i][0]))				{					$mod_pos_array = $_REQUEST['Mod_'.$i];					$mod_pos_array = array_flip ($mod_pos_array);						foreach ($mod_pos_array as $mod_id => $value)					{						$pos = $value + 1;						$sql_statement = 'UPDATE modules SET'																		.' position = '.$pos												.' WHERE mod_id = "'.$mod_id.'"'												;																					if ($result = UpdateDB ($sql_statement, $mysql_err_msg))						{$error = 0;}												else						{$error = 1;}											}				}							}										//	===================================================================================				//	------------------			Need do Syncing				---------------------------				//	===================================================================================												if (!$error)			{				echo '<p class = "OkMSG" >Module Positions Updated</p>'."\n";									}			else			{				echo '<p class = "WarningMSG" >ERROR! - Could NOT update all Module Positions</p>'."\n";			}							$do_not_return = 1;				break;			}				/*  		/////////	ERROR LOOGING - FOR testing	////////////////////////////////////////////////////		$err_log_str .= 		 "\n".'page_id - '.$page_id		."\n".'mod_id - '.$mod_id 	 		."\n".'mod_db_table - '.$mod_db_table		."\n".'mod_type_id - '.$mod_type_id 		."\n".'div_id - '.$div_id 		."\n".'position - '.$position 		."\n".'sync_id - '.$sync_id		."\n".'active - '.$active		."\n".'UserPageAccess($page_id) = '.UserPageAccess($page_id)		."\n".'$_SESSION[access] = '.$_SESSION['access']		."\n".'$_REQUEST[a] = '.$_REQUEST['a']		."\n"		."\n".'Mod_1[0] = '.$_REQUEST['Mod_1'][0]		."\n".'Mod_1[1] = '.$_REQUEST['Mod_1'][1]		."\n".'Mod_1[2] = '.$_REQUEST['Mod_1'][2]		."\n".'Mod_1[3] = '.$_REQUEST['Mod_1'][3]		."\n".'Mod_1[4] = '.$_REQUEST['Mod_1'][4]		."\n".'Mod_1[5] = '.$_REQUEST['Mod_1'][5]							."\n".'Mod_3[0] = '.$mod_pos_array[0]		."\n".'Mod_3[1] = '.$mod_pos_array[1]		."\n".'Mod_3[2] = '.$mod_pos_array[2]		."\n".'Mod_3[3] = '.$mod_pos_array[3]		."\n".'Mod_3[4] = '.$mod_pos_array[4]		."\n".'Mod_3[5] = '.$mod_pos_array[61]		."\n"		."\n".'mod_pos_array = '.$new_array		;		$log_filename = 'testing_log.txt';		$fopen = @fopen($filemane,'w');		$str .= 'testing output from: cms_update_mod_settings.php......'."\n".$err_log_str."\n";		fputs($fopen, $str);		fclose($fopen);		/////////////////////////////////////////////////////////////////////////////////////////////	*/	if ($do_not_return != 1)	{		$return_url = '/index.php?p='.$page_id;				//echo $return_url;				//	Re-Direct BACK		header('location: '.$return_url); 		exit();		}		?>